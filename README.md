# LZ-77 and Huffman archivator 

## Алгоритм (LZ77 + код Хаффмана)

1. **Чтение данных.** Файл полностью загружается в память как массив байт.
    
2. **Скользящее окно** (sliding window) —  ограниченная область уже‑прочитанных данных, с которой в данный момент сравнивается новая часть входного потока.
    
3. **Поиск совпадений.** Среди этих кандидатов выбирается максимальное совпадение длиной ≥ 3 байт (или фиксируется исходный символ, если совпадений нет).
    
4. **Сбор частот.** Подсчитываются частоты всех длин совпадений.
    
5. **Код Хаффмана.** По этим частотам строится префикс‑дерево и таблица бит‑кодов для каждой длины.
    
6. **Запись потока.**
    
    - В заголовок: исходный размер (8 байт), число длин (2 байта), пары (длина + частота) по 10 байт каждая.
        
    - В данные: для исходного символа — флаг 0 + 8 бит символа; для совпадения — флаг 1 + 15 бит расстояния + код Хаффмана длины.
        

---

## Алгоритм декодирования

1. **Чтение заголовка:** исходный размер и таблица (длина → частота).
    
2. **Восстановление дерева Хаффмана** по таблице.
    
3. **Чтение битов:**
    
    - флаг 0 → 8 бит исходного символа;
        
    - флаг 1 → 15 бит расстояния + бит‑код длины → копирование из ранее декодированных данных.
        
4. **Запись результата:** выходной файл идентичен исходному.
    

---

## Параметры

- Размер окна: **32768 байт** (32kb)
    
- Минимальная длина совпадения: **3 байта**
    
- Кодирование расстояния: **15 бит**
    
- Кодирование длины: **код Хаффмана**
    

---

Оптимизации которые сделанные: 

1. Вместо проверки всех 32 КБ мы проверяем только до 64 позиций, поэтому время поиска почти не зависит от размера окна.  
   Без хеширования сжатие занимало очень много времени — файл pic не удавалось сжать даже за 30 минут. С хеш‑таблицей тот же файл сжался примерно за пару минут.
    
2. **Минимальная длина совпадения = 3:** исключаем бесполезные короткие ссылки, экономя биты и время.
    

Hash‑chain — это хеш‑таблица, в ячейке которой хранится список недавних позиций с тем же хешем; поэтому для поиска совпадений проверяются только эти позиции, а не всё окно.
## Результаты (в алфавитном порядке)

| Файл      | H(X)   | H(X\|X) | H(X\|XX) | Size compressed | Avg bits/sym |
| --------- | ------ | ------- | -------- | --------------- | ------------ |
| bib       | 5.2007 | 3.3641  | 2.3075   | 40 065          | 2.880        |
| book1     | 5.0372 | 3.8877  | 2.6666   | 348 379         | 3.620        |
| book2     | 4.7926 | 3.7452  | 2.7357   | 232 788         | 3.054        |
| geo       | 1.2102 | 0.8237  | 0.7052   | 75 829          | 5.927        |
| news      | 5.1896 | 4.0919  | 2.9228   | 162 982         | 3.461        |
| obj1      | 5.9482 | 3.4637  | 1.4004   | 12 432          | 4.635        |
| obj2      | 5.4111 | 3.9307  | 1.8614   | 96 092          | 3.114        |
| paper1    | 5.1270 | 3.5684  | 2.1342   | 21 943          | 3.307        |
| paper2    | 4.9620 | 3.4253  | 2.0134   | 34 131          | 3.323        |
| paper3    | 4.8315 | 3.3083  | 2.0996   | 21 005          | 3.614        |
| paper4    | 4.6997 | 3.4773  | 2.2052   | 7 096           | 4.275        |
| paper5    | 4.9362 | 3.5260  | 2.0414   | 6 478           | 4.343        |
| paper6    | 5.2399 | 3.4728  | 1.9790   | 16 234          | 3.407        |
| pic       | 1.2102 | 0.8237  | 0.7052   | 70 459          | 1.099        |
| progc     | 5.1990 | 3.6034  | 2.1340   | 16 320          | 3.294        |
| progl     | 4.7701 | 3.2116  | 2.0436   | 20 555          | 2.298        |
| progp     | 4.8688 | 3.1875  | 1.7551   | 14 457          | 2.342        |
| trans     | 5.0111 | 3.5223  | 1.9589   | 23 846          | 2.037        |
| **Итого** |        |         |          | **1 221 091**   |              |

**Итого** — суммарный размер всех сжатых файлов в байтах (**1 221 091** байтa) .

Как проект компилировался:

```
g++  coder.cpp   -o coder.exe
g++  decoder.cpp -o decoder.exe
```

Проверка:

```
./coder.exe   book1  book1C
./decoder.exe book1C  book1D
```